<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Last 5 Spawns</title>
</head>
<body>

<div id="sprite-container" style="display:flex;gap:5px;">
    <img id="sprite0" style="width:150px;height:150px;display:none;">
    <img id="sprite1" style="width:150px;height:150px;display:none;">
    <img id="sprite2" style="width:150px;height:150px;display:none;">
    <img id="sprite3" style="width:150px;height:150px;display:none;">
    <img id="sprite4" style="width:150px;height:150px;display:none;">
</div>

<script>
    const backend_url = "https://poketwitch.bframework.de/";

    const spriteElements = [
        document.getElementById("sprite0"),
        document.getElementById("sprite1"),
        document.getElementById("sprite2"),
        document.getElementById("sprite3"),
        document.getElementById("sprite4")
    ];

    let last_pokedex_id = 0;
    let recentSpawns = [];

    function padId(id) {
        return id.toString().padStart(4, '0');
    }

    function updateSprites() {
        for (let i = 0; i < spriteElements.length; i++) {
            const sprite = spriteElements[i];
            if (i < recentSpawns.length) {
                const { pokedex_id } = recentSpawns[i];
                sprite.src = `https://projectpokemon.org/images/sprites-models/sv-sprites-home/${padId(pokedex_id)}.png`;
                sprite.style.display = "block";
            } else {
                sprite.style.display = "none";
            }
        }
    }

    function update_image() {
        fetch(backend_url + 'info/events/last_spawn/')
            .then(res => res.json())
            .then(data => {
                const { next_spawn, pokedex_id } = data;

                if (next_spawn > 30 + (60 * 13)) {
                    if (last_pokedex_id === pokedex_id) {
                        setTimeout(update_image, 3000);
                        return;
                    }

                    last_pokedex_id = pokedex_id;

                    // Add to list and trim
                    recentSpawns.unshift({ pokedex_id });
                    if (recentSpawns.length > 5) recentSpawns.pop();

                    updateSprites();

                    setTimeout(update_image, next_spawn * 1000);
                } else {
                    setTimeout(update_image, next_spawn * 1000);
                }
            })
            .catch(() => {
                setTimeout(update_image, 10000);
            });
    }

    update_image();
</script>

</body>
</html>
